= Настройка почты

Раздел содержит настройки сервиса _Workflow_ для обращения к почтовому серверу.

Начиная с версии 5.5.3 модуль _{wf}_ поддерживает работу в мультитенантном режиме. Раньше настройки по умолчанию устанавливались для БД по умолчанию. Теперь, когда БД несколько, при первом открытии настроек модуль попытается автоматически скопировать настройки. Если попытка окажется неудачной, будет выдано предупреждение. В таком случае настройки можно выполнить при помощи xref:Mail_Settings_on_Separate_Server.adoc[программы "{dv} Настройки почты для Workflow"].

При первоначальной установке модуля (не обновлении) выполните следующие действия, чтобы задать настройки для обращения к почтовому серверу:

. В разделе настроек модуля _{wf}_ найдите блок "Назначение сервисов для обработки баз данных".
+
image::sc_wfpage_DB.png[Блок "Назначение сервисов для обработки баз данных"]
. Найдите *Настройки почты* (6) и нажмите кнопку *Изменить* (7).
+
[NOTE]
====
[.note__title]#Прим.:

Кнопка "Изменить" для почтового шлюза доступна только, когда в списке выбран сервис с сервера, на котором установлен модуль {pl} с Консолью настройки {dv}. Настроить шлюз можно только физически на машине, где установлен данный сервис.
====
+
Будет открыто диалоговое окно [.keyword .wintitle]*Настройки почты*.

image::sc_wfpage_mail.png[Окно "Настройки почты"]
. В поле *Тип сервера* выберите тип используемого почтового сервера:
* [.kbd .ph .userinput]`MS Exchange`
* [.kbd .ph .userinput]`SMTP/POP3`
* [.kbd .ph .userinput]`Exchange Web Services` (только MS Exchange 2007 SP1 или MS Exchange 2010).
. В поле *E-mail сервера* укажите адрес электронной почты, которым будет пользоваться сервер управления процессами (например, для пересылки электронных писем исполнителям заданий при использовании офлайн-маршрутизации). #
. Если выбран тип (почтового) сервера *MS Exchange*, укажите:
* *Профиль MS Exchange* – название профиля для работы с Microsoft Exchange.
+
Профиль нужно настроить самостоятельно, используя инструмент menu:Панель управления[Почта] (должен быть установлен Microsoft Outlook x86). У учетной записи должны быть права на отправку, получение и удаление электронных писем.
. Если выбран тип сервера *SMTP/POP3*, укажите:
* в поле *Отправка* – тип отправки писем (локальный или удаленный), он зависит от настроек SMTP/POP3 сервера. Если выбрана _Локальная_ отправка, письма будут формироваться при помощи приложений Execlogic и перемещаться в папку на сервере Workflow. Сама папка должны быть указана в конфигурационном файле приложения Execlogic.
+
[NOTE]
====
Чтобы указать папку в конфигурационном файле приложения Execlogic, добавьте следующие строки в файлы `ExecLogic.exe.config` и `ExecLogic32.exe.config`:

[source,pre,codeblock]
----
<system.net>
<mailSettings>
<smtp deliveryMethod="SpecifiedPickupDirectory">
<specifiedPickupDirectory pickupDirectoryLocation="Путь-к-каталогу-для-формирования-писем" />
</smtp>
</mailSettings>
</system.net>
----
====
* Для *SMTP сервера*:
** в поле *SMTP сервер* – имя сервера;
** флаг *SSL* -- при наличии флага допускается использование протокола защищенного обмена данными *SSL*; 
** в поле *Аутентификация* – тип аутентификации пользователя: [.kbd .ph .userinput]`Нет`, [.kbd .ph .userinput]`Простая` – логин и пароль пользователя указывается явно, [.kbd .ph .userinput]`NTLM` – доступ осуществляется от лица текущего пользователя;
** *Имя пользователя* и *Пароль* для доступа к почтовому ящику;
** если выбран удаленный тип отправки сообщений, то в случае нестандартной конфигурации SMTP сервера можно нажать кнопку *Дополнительно* и в открывшемся окне [.keyword .wintitle]*Дополнительные настройки почты* указать *Порт SMTP*, который будет использован для подключения к серверу и отправки писем; по умолчанию используется стандартный порт [.kbd .ph .userinput]`SMTP 25`;
+
image::Process_Management_Additional_Mail_Settings.png[Окно "Дополнительные настройки почты"]
+
[NOTE]
====
SSL при работе по SMTP поддерживается только как расширение службы SMTP для Secure SMTP через TLS.   Подключение SMTP/SSL не поддерживается. Поэтому, вместо порта 465, который используется по умолчанию для   SMTP/SSL, следует указывать порт 587.
====
* Для *POP3 сервера*:
** в поле *POP3 сервер* – имя сервера;
** флаг *SSL* -- при наличии флага допускается использование протокола защищенного обмена данными *SSL*; 
** в поле *Аутентификация* – тип аутентификации пользователя: [.kbd .ph .userinput]`простой` – логин и пароль пользователя указывается явно, [.kbd .ph .userinput]`NTLM` – доступ осуществляется от лица текущего пользователя;
** *Имя пользователя* и *Пароль* для доступа к почтовому ящику;
** если выбран удаленный тип отправки сообщений, то в случае нестандартной конфигурации POP3 сервера можно нажать кнопку *Дополнительно* и в открывшемся окне [.keyword .wintitle]*Дополнительные настройки почты* указать *Порт POP3*, который будет использован для подключения к серверу.
. Если выбран тип сервера *Exchange Web Services*, укажите:
* *Адрес сервера для подключения* -- адрес электронной почты, зарегистрированной в веб-службе Exchange и ассоциированной с учетной записью сервиса Workflow или явный адрес сервера;
+
[NOTE]
====
Workflow использует функцию https://docs.microsoft.com/ru-ru/exchange/client-developer/exchange-web-services/autodiscover-for-exchange[автообнаружения] точки подключения к Exchange Web Services по адресу электронной почты, указанной в поле "Адрес сервера для подключения". Если указан явный адрес сервера, автообнаружение будет отключено. См. дополнительные настройки автообнаружения в пункте xref:ExchangeWebServicesConfig.adoc[Разрешение перенаправления при автообнаружении конечной точки Exchange Web Services].
====
* *Аутентификация* – тип аутентификации пользователя: [.kbd .ph .userinput]`простой` – логин и пароль пользователя указывается явно, [.kbd .ph .userinput]`NTLM` – доступ осуществляется от лица текущего пользователя;
* *Имя пользователя* и *Пароль* для подключения к Exchange WebServices, если используется [.kbd .ph .userinput]`простой` тип аутентификации.
. Чтобы все произведенные изменения вступили в силу, сохраните их и перезапустите сервис Workflow. #
* *xref:ExchangeWebServicesConfig.adoc[Разрешение перенаправления при автообнаружении конечной точки Exchange Web Services]* +
* *xref:oauth.adoc[Авторизация через OAuth при использовании Exchange Web Services]* +
