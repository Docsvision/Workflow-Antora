= Настройка почты

Раздел содержит настройки сервиса _Workflow_ для обращения к почтовому серверу.

Начиная с версии 5.5.3 модуль _{wf}_ поддерживает работу в мультитенантном режиме. Раньше настройки по умолчанию устанавливались для БД по умолчанию. Теперь, когда БД несколько, при первом открытии настроек модуль попытается автоматически скопировать настройки. Если попытка окажется неудачной, будет выдано предупреждение. В таком случае настройки можно выполнить при помощи xref:Mail_Settings_on_Separate_Server.adoc[программы "{dv} Настройки почты для Workflow"].

.При первоначальной установке модуля (не обновлении) выполните следующие действия, чтобы задать настройки для обращения к почтовому серверу:
. В разделе настроек модуля _{wf}_ найдите блок _Назначение сервисов для обработки баз данных_.
+
.Блок "Назначение сервисов для обработки баз данных"
image::services-designation.png[Блок "Назначение сервисов для обработки баз данных"]
+
. Найдите _Настройки почты_ (6) и нажмите кнопку *Изменить* (7).
+
[NOTE]
====
Кнопка *Изменить* для почтового шлюза доступна только, когда в списке выбран сервис с сервера, на котором установлен модуль {pl} с Консолью настройки {dv}. Настроить шлюз можно только физически на машине, где установлен данный сервис.
====
+
.Окно "Настройки почты"
image::mail-settings.png[Окно "Настройки почты"]
+
. В окне _Настройки почты_ найдите поле _Тип сервера_ и выберите тип используемого почтового сервера:
+
* *_MS Exchange_*
* *_SMTP/POP3_*
* *_Exchange Web Services_* -- только MS Exchange 2007 SP1 или MS Exchange 2010.
+
. В поле _E-mail сервера_ укажите адрес электронной почты, которым будет пользоваться сервер управления процессами, например, для пересылки электронных писем исполнителям заданий при использовании офлайн-маршрутизации.
. Если выбран тип (почтового) сервера *_MS Exchange_*, укажите:
+
* *_Профиль MS Exchange_* -- название профиля для работы с Microsoft Exchange.
+
Профиль нужно настроить самостоятельно, используя инструмент menu:Панель управления[Почта] (должен быть установлен Microsoft Outlook x86). У учетной записи должны быть права на отправку, получение и удаление электронных писем.
. Выполните настройки для выбранного типа сервера:
+
* Если выбран тип сервера *_SMTP/POP3_*, укажите:
+
** В поле _Отправка_ -- тип отправки писем (локальный или удаленный), он зависит от настроек SMTP/POP3 сервера. Если выбрана _Локальная_ отправка, письма будут формироваться при помощи приложений Execlogic и перемещаться в папку на сервере Workflow. Сама папка должны быть указана в конфигурационном файле приложения Execlogic.
+
****
Чтобы указать папку в конфигурационном файле приложения Execlogic, добавьте следующие строки в файлы `ExecLogic.exe.config` и `ExecLogic32.exe.config`:

[source,pre,codeblock]
----
<system.net>
<mailSettings>
<smtp deliveryMethod="SpecifiedPickupDirectory">
<specifiedPickupDirectory pickupDirectoryLocation="Путь-к-каталогу-для-формирования-писем" />
</smtp>
</mailSettings>
</system.net>
----
****
+
* Для *_SMTP сервера_*:
** В поле *_SMTP сервер_* -- имя сервера.
** Флаг `*SSL*` -- при наличии флага допускается использование протокола защищенного обмена данными _SSL_.
** В поле _Аутентификация_ -- тип аутентификации пользователя:
+
*** *_Нет_*.
*** *_Простая_* -- логин и пароль пользователя указывается явно.
*** *_NTLM_* -- доступ осуществляется от лица текущего пользователя.
+
** _Имя пользователя_ и _Пароль_ для доступа к почтовому ящику.
** Если выбран удаленный тип отправки сообщений, то в случае нестандартной конфигурации SMTP сервера можно нажать кнопку *Дополнительно* и в открывшемся окне _Дополнительные настройки почты_ указать _Порт SMTP_, который будет использован для подключения к серверу и отправки писем. По умолчанию используется стандартный порт `SMTP 25`.
+
.Окно "Дополнительные настройки почты"
image::additional-mail-settings.png[Окно "Дополнительные настройки почты"]
+
[NOTE]
====
SSL при работе по SMTP поддерживается только как расширение службы SMTP для Secure SMTP через TLS. Подключение SMTP/SSL не поддерживается. Поэтому, вместо порта `465`, который используется по умолчанию для SMTP/SSL, следует указывать порт `587`.
====
+
* Для *_POP3 сервера_*:
** В поле _POP3 сервер_ -- имя сервера.
** Флаг *SSL* -- при наличии флага допускается использование протокола защищенного обмена данными *SSL*.
** В поле _Аутентификация_ -- тип аутентификации пользователя:
+
*** *_Простая_* -- логин и пароль пользователя указывается явно.
*** *_NTLM_* -- доступ осуществляется от лица текущего пользователя.
+
** _Имя пользователя_ и _Пароль_ для доступа к почтовому ящику;
** Если выбран удаленный тип отправки сообщений, в случае нестандартной конфигурации POP3 сервера можно нажать кнопку *Дополнительно* и в открывшемся окне _Дополнительные настройки почты_ указать _Порт POP3_, который будет использован для подключения к серверу.
+
. Если выбран тип сервера _Exchange Web Services_, укажите:
* _Адрес сервера для подключения_ -- адрес электронной почты, зарегистрированной в веб-службе Exchange и ассоциированной с учетной записью сервиса Workflow или явный адрес сервера.
+
[NOTE]
====
Workflow использует функцию https://docs.microsoft.com/ru-ru/exchange/client-developer/exchange-web-services/autodiscover-for-exchange[автообнаружения] точки подключения к Exchange Web Services по адресу электронной почты, указанной в поле _Адрес сервера для подключения_. Если указан явный адрес сервера, автообнаружение будет отключено. См. дополнительные настройки автообнаружения в пункте "xref:ExchangeWebServicesConfig.adoc[]".
====
+
* _Аутентификация_ -- тип аутентификации пользователя: `простой` -- логин и пароль пользователя указывается явно, `NTLM` -- доступ осуществляется от лица текущего пользователя;
* _Имя пользователя_ и _Пароль_ для подключения к Exchange WebServices, если используется *_Простая_* тип аутентификации.
+
. Чтобы все произведенные изменения вступили в силу, сохраните их и перезапустите сервис Workflow.
