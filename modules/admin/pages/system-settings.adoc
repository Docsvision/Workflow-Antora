= Настройки модуля в справочнике Системные настройки

.Справочник "Системные настройки" содержит настройки модуля "{wf}", позволяющие:
* Управлять уровнем журналирования работы БП.
* Настраивать параметры работы _шлюзов_.
* Добавлять и настраивать _функции_.
* Добавлять сборки, содержащие функции для использования в "xref:user:functions/basic/universal/function.adoc[Универсальной функции]".

[#launch]
== Запуск справочника "Системные настройки"

. Запустите {wincl} от имени администратора {dv}.
. В дереве папок откройте раздел menu:Конструкторы и справочники[Системные настройки].
+
.Справочник "Системные настройки"
image::sys-settings.png[Справочник "Системные настройки"]

[#sections]
== Системные настройки модуля {wf}

[#processes]
=== Настройки процессов

Для процессов приложения _{wf}_ можно указать уровень журналирования (глубины сбора информации), который будет использоваться по умолчанию во всех бизнес-процессах системы.

.Чтобы определить настройки процессов, выполните следующие действия:
. В области _Категории_ выберите ветку menu:Настройки Workflow[Настройки процессов].
+
При этом в средней части карточки справочника будет отображена область _Настройки процессов_.
+
.Настройки процессов
image::wf-processes.png[Настройки процессов]
+
. В поле _Уровень журналирования по умолчанию_ задайте необходимый уровень:
+
* *_Не вести журнал_*.
* *_Ошибки_*: в журнал будет заноситься информация об ошибках и об информационных сообщениях с важностью большей или равной 10.
* *_Предупреждения_*: в журнал будет заноситься информация об ошибках и предупреждениях, а также об информационных сообщениях с важностью большей или равной 5.
* *_Все сообщения_*.
+
Для бизнес-процессов не предусмотрены какие-либо дополнительные настройки, поэтому опции окна расширенных настроек этого элемента повторяют описанные выше.

[#gates]
=== Шлюзы

Шлюз представляет собой программный компонент, обеспечивающий взаимодействие какого-либо программного продукта с другими программами. Через шлюзы осуществляется взаимодействие приложения _{wf}_ со следующими компонентами:

* Базовые функции.
* Файловая система.
* {dv}.
* Почтовая система.

.Чтобы настроить шлюзы, выполните следующие действия:
. В области _Категории_ выберите ветку menu:Настройки Workflow[Шлюзы].
+
При этом в средней части карточки справочника будет отображена область _Шлюзы_.
+
Центральная часть окна _Шлюзы_ содержит список шлюзов, зарегистрированных в приложении _{wf}_.
+
.Раздел шлюзы в справочнике "Системные настройки"
image::sys-settings-gates.png[Раздел "Шлюзы" в справочнике "Системные настройки"]
+
. Чтобы сделать доступной для просмотра или редактирования запись какого-либо шлюза, дважды щелкните левой кнопкой мыши по нужной строке списка или выберите из контекстного меню этой строки команду *Изменить*.
+
Будет открыто окно _Настройки шлюза_.
+
.Настройки шлюза
image::gate-settings.png[Настройки шлюза]
+
. В поле _Имя_ укажите название шлюза.
. При необходимости установите флаг `*Автоматически добавлять шлюз в новые процессы*`.
. В поле _UI класс_ укажите программный идентификатор клиентского компонента шлюза.
. В поле _Класс_ укажите название класса в серверном компоненте шлюза.
. В поле _Сборка_ укажите путь к сборке серверного компонента шлюза.
. В поле _Строка лицензии_ укажите ссылки на лицензии для шлюзов, предполагающих наличие лицензии:
+
Шлюзы, включенные в стандартную поставку {dv}, лицензирования не требуют.
+
.Для шлюзов, требующих лицензирования, возможны следующие варианты заполнения поля "Строка лицензии":
* Поле не заполняется, если лицензирование шлюза поддерживается {dv}.
* Надпись над полем принимает вид Лицензирование шлюза: опция лицензии на {dv}.
* В поле вводится строка лицензионного ключа.
* В поле вводится ссылка на файл с лицензионным ключом.
+
. Чтобы настроить параметры подключения к шлюзу, нажмите на кнопку *Настройка*.
+
Будет открыто окно _Свойств шлюза_.
+
. Чтобы импортировать из файловой системы файл формата `.xml`, содержащий настройки шлюза, нажмите на кнопку *Загрузить описание*.
. Маловероятно, что потребуется вручную добавлять или редактировать запись о каком-либо из шлюзов, однако такая возможность имеется. Чтобы добавить в карточку запись о новом шлюзе, выберите из контекстного меню команду _Добавить_.
+
После добавления записи о шлюзе в карточку системных настроек он становится доступен для использования в бизнес-процессах, а также программно в объектной модели системы.
+
. Чтобы удалить запись о шлюзе, выберите из контекстного меню команду _Удалить_.
+
Удалить запись можно во время работы использующего данный шлюз бизнес-процесса. Шлюз в таком случае будет остановлен из-за ошибки. При попытке открыть шаблон или экземпляр бизнес-процесса, использующие удалённый шлюз, пользователь будет предупреждён об отсутствии в системе необходимого для работы процесса шлюза.

[#functions]
=== Функции

_Функции_ приложения _{wf}_ предназначены для поэтапного описания бизнес-процесса. Назначение и сложность функций различны: функция может, например, просто задержать продолжение выполнения процесса до определенного момента, а может самостоятельно создать сложный бизнес-процесс.

.Чтобы настроить функции, выполните следующие действия
. В области _Категории_ выберите ветку menu:Настройки Workflow[Функции].
+
При этом в средней части карточки справочника будет отображена область _Функции_.
+
Центральная часть окна _Функции_ содержит список функций, зарегистрированных в приложении _{wf}_ и список преднастроенных функций (шаблонов) для каждой из функций.
+
.Раздел "Функции" в справочнике "Системные настройки"
image::sys-settings-functions.png[Раздел "Функции" в справочнике "Системные настройки"]
+
.  Чтобы описать новую функцию, выберите из контекстного меню команду _Добавить_.
+
Будет открыто окно _Настройки функции_.
+
.Настройки функции
image::function-settings.png[Настройки функции]
+
. В поле _Название_ введите название функции.
. В поле _Интервал опроса_ укажите задержку (в минутах) перед повторным исполнением функции в циклическом бизнес-процессе.
+
Начало повторного исполнения функции рассчитывается путем добавления периода опроса к моменту предыдущего исполнения функции. Например, если функция завершила исполнение в `16:00`, период опроса равен `5` минутам, повторное исполнение функции произойдет при первой обработке функции сервером бизнес-процессов после `16:05`.
+
. Если данная функция является начальной, установите флаг `*Стартовая функция*`.
. Если данная функция является конечной, установите флаг `*Конечная функция*`.
. Если функция не используется в текущей версии {dv}, установите флаг `*Устаревшая функция*`.
+
Устаревшая функция не будет отображаться на функциональной панели карточки бизнес-процесса и, следовательно, её нельзя использовать при создании нового бизнес-процесса. Если устаревшая функция используется в уже существующем в системе бизнес-процессе, она будет отображаться на его графе (но не на функциональной панели).
+
. В поле _UI класс_ (клиентский компонент) укажите программный идентификатор клиентского компонента функции.
. В поле _Класс_ укажите название класса функции в серверном компоненте функции.
. В поле _Сборка_ укажите название (путь) к сборке (assembly) серверного компонента функции.
. Нажмите на кнопку *ОК*.
+
После добавления записи о новой функции в карточку системных настроек она становится доступной для использования в бизнес-процессах, а также программно в объектной модели системы.
+
. Для просмотра подробного описания существующей функции дважды щелкните по её названию левой кнопкой мыши или выберите из контекстного меню команду _Изменить_.
. Удалить имеющуюся функцию можно при помощи команды контекстного меню _Удалить_.
. Описание преднастроенной функции можно просмотреть в отдельном окне. Чтобы его открыть, выберите нужную преднастроенную функцию в списке и дважды щелкните по ней левой клавишей мыши.

[#builds]
=== Сборки

В окне элемента _Сборки_ отображаются записи о зарегистрированных пользовательских .Net-сборках. Зарегистрированную сборку можно использовать как пользовательскую функцию, вставляя её в бизнес-процессы с помощью универсальной функции.

.Чтобы добавить новую сборку, выполните следующие действия:
. В области _Категории_ выберите ветку menu:Настройки Workflow[Сборки].
+
При этом в средней части карточки справочника будет отображена область _Сборки_.
+
.Раздел "Сборки" в справочнике "Системные настройки"
image::sys-settings-builds.png[Раздел "Сборки" в справочнике "Системные настройки"]
+
. Если в файловой системе уже есть файл формата `.dll`, содержащий готовую сборку, выполните следующие действия:
.. Щелкните правой клавишей мыши в центральной части области _Сборки_.
.. Из появившегося контекстного меню выберите пункт _Добавить сборку_.
.. В открывшемся окне выберите нужный файл из файловой системы.
+
Чтобы обеспечить возможность повторного использования сценария в виде скомпилированной сборки, в нем обязательно должен быть хоть один публичный (publiс) класс, а в нем должны присутствовать публичные статические (public static) методы. +
Скомпилированные и подключенные сборки должны находится в папке Workflow (при стандартной установке это `C:\Program Files (x86)\Docsvision\Workflow\`).
. Если нужного файла формата `.dll` еще нет, следует создать его с помощью функции _Сценарий_. Сразу после компилирования сборка отобразится в списке данного окна.
