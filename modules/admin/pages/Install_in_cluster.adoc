= Настройка кластера СУБП

Общее описание кластера СУБП приведено в разделе xref:Cluster_description.adoc[Кластеризация СУБП].

Кластеризация модуля (создание кластера) рекомендуется в случаях, когда число одновременно работающих БП в системе {dv} превышает 5000 экземпляров, исходя из примерного расчета: 1 экземпляр модуля на каждые 5000 активных БП.

Обязательные условие для работы кластера СУБП:

. На компьютере с сервером {dv} должна быть установлена серверная часть модуля _{wf}_ (требуется для управления кластером).
. На всех узлах кластера должна быть установлена одинаковая версия модуля _{wf}_. Обновления и исправления модуля должны устанавливаться на все узлы кластера.
. На всех узлах кластера должен быть установлен одинаковый набор Шлюзов.
. Если в настройках модуля _{wf}_ в _Консоли настройки {dv}_ указан *Сертификат* (с помощью которого выполняется подписание и шифрование в БП), то данный сертификат должен быть установлен на всех узлах кластера, а личный ключ от него установлен в локальное хранилище на каждом узле. Сертификат и его ключи должны быть доступны для каждой учетной записи СУБП кластера.
. Дополнительные узлы предъявляют собственные требования к системе (приведены в пункте xref:ROOT:requirements-separate.adoc[Требования отдельной установки СУБП]).

Чтобы настроить кластер _{wf}_ нужно:

. Установите серверную часть модуля _{wf}_ на второй узел кластера следуя xref:install-server.adoc[инструкции по установке].
. Включить второй узел в кластер:
[loweralpha]
.. Открыть _{cns}_ на компьютере с сервером {dv}.
.. Перейти в раздел настроек menu:Модули расширения[{wf}].
+
image::sc_wfpage_cluster.png[Страница настроек _{wf}_]
.. Ввести в поле `Имя компьютера` сетевое имя второго узла кластера.
.. В поле `Доля процесса` ввести целое число больше "0", определяющее относительную нагрузку на данный узел кластера.
+
Чтобы поровну распределить нагрузку между двумя узлами кластера, установите одинаковое значение (например, "1") в доле процесса у обоих узлов. Чтобы снять нагрузку с определенного узла кластера, установите значение "0" в его в доле процесса.
.. Нажать на кнопку *Добавить*. В список *Сервисы бизнес-процессов* будет добавлена новая запись с именем компьютера, на указанный узел кластера будут переданы требуемые для работы настройки (данные для подключения к серверу {dv} и др.).
+
image::sc_wfpage_cluster_two.png[Страница настроек _{wf}_]
+
Чтобы позже увеличить или уменьшить нагрузку сервиса, нужно выделить его в списке сервисов, изменить соответствующим образом значение поля *Доля в процессе* и нажать кнопку *Установить*.

Чтобы проверить корректность настроек, на втором узле кластера зайдите в реестр Windows, и проверьте в ветке `HKLM\SOFTWARE\{dv}\Workflow\5.5` значения ключей `BaseName` и `SiteUrl`. Здесь должны быть указаны название БД {dv} и адрес сервера {dv} первого узла.
