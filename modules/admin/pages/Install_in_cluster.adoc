=  Настройка кластера СУБП

Общее описание кластера СУБП приведено в разделе xref:Cluster_description.adoc[Кластеризация СУБП].

Кластеризация Модуля (создание кластера) рекомендуется в случаях, когда число одновременно работающих БП в системе Docsvision превышает 5000 экземпляров, исходя из примерного расчета: 1 экземпляр Модуля на каждые 5000 активных БП.

Обязательные условие для работы кластера СУБП:

. На компьютере с сервером Docsvision должна быть установлена серверная часть модуля «Управление процессами» (требуется для управления кластером).
. На всех узлах кластера должна быть установлена одинаковая версия модуля «Управление процессами». Обновления и исправления Модуля должны устанавливаться на все узлы кластера.
. На всех узлах кластера должен быть установлен одинаковый набор Шлюзов.
. Если в настройках модуля «Управление процессами» в _Консоли настройки Docsvision_ указан [.ph .uicontrol]*Сертификат* (с помощью которого выполняется подписание и шифрование в БП), то данный сертификат должен быть установлен на всех узлах кластера, а личный ключ от него установлен в локальное хранилище на каждом узле. Сертификат и его ключи должны быть доступны для каждой учетной записи СУБП кластера.
. Дополнительные узлы предъявляют собственные требования к системе (приведены в пункте xref:Required_resources_node.adoc[Требования отдельной установки СУБП]).

Чтобы настроить кластер «Управление процессами» нужно:

. [.ph .cmd]#Установите серверную часть модуля «Управление процессами» на второй узел кластера следуя xref:Install_server.adoc[инструкции по установке].#
. [.ph .cmd]#Включить второй узел в кластер:#
[loweralpha]
.. [.ph .cmd]#Открыть «Консоль настройки Docsvision» на компьютере с сервером Docsvision.#
.. [.ph .cmd]#Перейти в раздел настроек [.ph .menucascade]#[.ph .uicontrol]*Модули расширения* > [.ph .uicontrol]*Управление процессами*#.#
+
image::sc_wfpage_cluster.png[[.fig--title-label]##Figure 1. ##Страница настроек «Управление процессами»]
.. [.ph .cmd]#Ввести в поле [.kbd .ph .userinput]`Имя компьютера` сетевое имя второго узла кластера.#
.. [.ph .cmd]#В поле [.kbd .ph .userinput]`Доля процесса` ввести целое число больше «0», определяющее относительную нагрузку на данный узел кластера.#
+
Чтобы поровну распределить нагрузку между двумя узлами кластера, установите одинаковое значение (например, «1») в доле процесса у обоих узлов. Чтобы снять нагрузку с определенного узла кластера, установите значение «0» в его в доле процесса.
.. [.ph .cmd]#Нажать на кнопку [.ph .uicontrol]*Добавить*. В список [.ph .uicontrol]*Сервисы бизнес-процессов* будет добавлена новая запись с именем компьютера, на указанный узел кластера будут переданы требуемые для работы настройки (данные для подключения к серверу Docsvision и др.).#
+
image::sc_wfpage_cluster_two.png[[.fig--title-label]##Figure 2. ##Страница настроек «Управление процессами»]
+
Чтобы позже увеличить или уменьшить нагрузку сервиса, нужно выделить его в списке сервисов, изменить соответствующим образом значение поля [.ph .uicontrol]*Доля в процессе* и нажать кнопку [.ph .uicontrol]*Установить*.

Чтобы проверить корректность настроек, на втором узле кластера зайдите в реестр Windows, и проверьте в ветке [.ph .filepath]`HKLM\SOFTWARE\DocsVision\Workflow\5.5` значения ключей `BaseName` и `SiteUrl`. Здесь должны быть указаны название БД Docsvision и адрес сервера Docsvision первого узла.

*Parent topic:* xref:Cluster_description.adoc[Кластеризация СУБП]
