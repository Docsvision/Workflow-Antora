= Мониторинг файловой системы

== Пиктограмма функции

image:Buttons/Function_Monitoring_File_System.png[image]

== Общее описание функции

Функция *Мониторинг файловой системы* позволяет серверу {dv} обнаружить в указанной папке файлы, подходящие под условие фильтра. Если файлы будут найдены, выполнение функции будет завершено. При определенных настройках, функция позволяет выполнять обнаружение появления файлов в папке.

Дополнительно, функция позволяет фиксировать изменения указанного файла. В настройках функции мониторинга указывается, в какую переменную процесса будет возвращена ссылка на найденный файл или файлы.

== Настройка параметров

image::Parameters_Monitoring_File_System.png[Окно свойств функции "Мониторинг файловой системы". Вкладка " Параметры"]

Параметры подпроцесса определяются на вкладке *Параметры* окна свойств функции *Мониторинг файловой системы*.

Параметр процесса -- файл::
  Переменная бизнес-процесса типа _файл ФС_, в которую будут возвращены найденные файлы.
  +
  При мониторинге папки под запрос могут подходить несколько файлов. Если в поле *Параметр процесса -- файл* указать переменную типа xref:Variable_Types.adoc[файл ФС] с отмеченным признаком *Коллекция значений*, в неё будут записаны все найденные файлы. Если же указать переменную типа *файл ФС* без признака *Коллекция значений*,  в неё будет записан только первый найденный файл.
Очищать историю мониторинга::
  Значение (или переменная бизнес-процесса типа _Да/Нет_), указанное в данном поле определяет, будет ли удаляться история мониторинга. При сохранении истории (значение поля `Нет`) при повторном выполнении функции будет производиться мониторинг только вновь появившихся файлов; при удалении истории (значение поля `Да`) при повторном выполнении функции будут обнаружены все файлы, найденные в прошлый раз, а также все вновь появившиеся файлы.
При неудаче активировать связь::
  Название функции, которой будет передано управление процессом в случае, если объект с нужными свойствами не будет найден при однократном мониторинге. Поле не обязательно для заполнения.
  +
  "Неудачей" считается как отсутствие найденных объектов (при мониторинге папки), так и отсутствие изменений в указанном файле (при мониторинге изменений файла). Если оставить поле пустым, функция будет ожидать только положительного результата (появления файла, подходящего под запрос, или появления изменений в указанном файле).

Далее следует выбрать один из переключателей (*Мониторинг папки файловой системы* или *Мониторинг изменений файла*), в соответствии с которым будет производиться мониторинг объектов в какой-либо папке или мониторинг изменения какого-либо объекта.

Мониторинг папки файловой системы::
  Указывает, что должен производиться мониторинг папки файловой системы; при этом следует указать также:
  +
  * *Папка файловой системы*: полный сетевой путь к папке файловой системы (или переменная бизнес-процесса типа xref:Variable_Types.adoc[папка ФС]), мониторинг которой будет осуществляться;
  * *Фильтр папки*: фильтр задается вручную как стандартный шаблон имен искомых файлов (*.*).
  +
  Примеры фильтров:

  ** [.keyword .parmname]_*.*_ -- поиск любого файла с любым расширением;
  ** [.keyword .parmname]_Документ.doc_ -- поиск определенного файла с определенным расширением;
  ** [.keyword .parmname]_*.doc?_ -- поиск файлов MS Word формата doc и docx;
  ** [.keyword .parmname]_Договор*_ -- поиск файлов с любыми расширениями, которые начинаются со слова "Договор".
  * *Искать в подпапках*: при установленном флажке будет производиться мониторинг не только указанной папки, но и всех её дочерних папок;
Мониторинг изменений файла::
  Указывает, что должен производиться мониторинг файла по дате его последнего редактирования: если изменилась дата последнего редактирования файла, считается, что в файле произошли изменения; при выборе данного переключателя в следующем поле следует указать необходимый параметр:
  +
  * *Выбранный файл* -- файл из файловой системы (или переменная бизнес-процесса типа файл ФС), изменение которого будет отслеживаться функцией мониторинга

[NOTE]
====
Для корректной работы мониторинга необходимо, чтобы между функцией мониторинга и функцией, указанной в поле *При неудаче активировать связь*, была установлена связь типа _При успехе_, иначе при неудаче мониторинга процесс будет остановлен из-за ошибки. Связь типа _При ошибке_ между функцией мониторинга и указанной в поле *При неудаче активировать связь* функцией устанавливают, если управление должно перейти к ней в случае невозможности мониторинга (например, недоступности его объекта); иначе в этом случае процесс будет остановлен из-за ошибки. При необходимости связи типа _При ошибке_ и _При успехе_ можно установить одновременно.
====
