= Мониторинг {dv}

== Пиктограмма функции

image:Buttons/Function_Monitoring_{dv}.png[image]

== Общее описание функции

Функция *Мониторинг {dv}* позволяет обнаружить объект {dv}, обладающий определенными свойствами (аналогично поиску объектов, соответствующих критериям фильтрации), или отслеживать вносимые в карточку изменения (добавление/удаление строк, изменение значения поля), а также находить версии карточек файлов. В настройках функции мониторинга указывается переменная процесса, в которую будет возвращена ссылка на найденный объект (или объекты: для этого следует указать переменную-коллекцию).

== Настройка параметров

image::Parameters_Monitoring_{dv}.png[Свойства функции "Мониторинг {dv}". Вкладка "Параметры"]

На вкладке *Параметры* окна свойств функции указываются параметры мониторинга карточек {dv}.

Очищать историю мониторинга::
  В поле выбирается значение (или переменная бизнес-процесса) типа да/нет, которое определяет, будет ли удаляться (да) или сохраняться (нет) история мониторинга при повторном выполнении функции. При удалении истории каждый повторный запуск функции мониторинга обеспечивает поиск всех удовлетворяющих условию объектов {dv} без учета результатов предыдущего мониторинга. Например, после добавления нового документа повторный мониторинг {dv} приведет к обработке всех документов папки, если в данном поле указано `Да`, и к обработке только вновь появившегося документа, если в данном поле указано `Нет`.
При неудаче активировать связь::
  В поле может быть занесено название функции, которой будет передано управление процессом в случае если объект с нужными свойствами не будет найден при однократном мониторинге.

Для корректной работы мониторинга необходимо, чтобы между функцией мониторинга и функцией, указанной в поле *При неудаче активировать связь*, была установлена связь типа `При успехе`, иначе при неудаче мониторинга процесс будет остановлен из-за ошибки. Связь типа `При ошибке` между функцией мониторинга и указанной в поле *При неудаче активировать связь* функцией устанавливают, если управление должно перейти к ней в случае невозможности мониторинга (например, недоступности его объекта); иначе в этом случае процесс будет остановлен из-за ошибки. При необходимости связи типа `При ошибке` и `При успехе` можно установить одновременно.

Далее следуют два переключателя, позволяющие выбрать, над чем будет производиться мониторинг: над объектами (*Мониторинг карточек {dv}*) или над событиями, происходящими с каким-либо объектом (*Мониторинг карточки*). Естественно, что возможен выбор только одного из переключателей; после выбора переключателя становится доступной для описания соответствующая группа параметров

Мониторинг карточек {dv}::
  Переключатель позволяет обнаруживать уже имеющиеся и вновь появляющиеся карточки {dv}, соответствующие указанным критериям. Параметры мониторинга указываются в следующих полях:
  +
  * в поле *Параметр процесса -- карточка* указывается переменная бизнес-процесса типа карточка DV, в которую будет возвращена ссылка на найденную карточку (карточки);
  * в раскрывающихся списках поля *Сортировать результаты* выбираются параметры сортировки, предназначенные для упорядочения результатов мониторинга; при этом в первом списке выбирается тип сортировки (Не сортировать, По дате создания, По дате изменения, По дайджесту), а во втором -- способ сортировки (По возрастанию или По убыванию);
  * в поле *Папка поиска* и при помощи следующего флага *Искать в подпапках* следует указать область поиска; если область поиска не задана, поиск осуществляется по всем папкам системы;
  * *Фильтр карточек* позволяет установить параметры поиска карточек с помощью кнопки *Настроить фильтр*; действие производится аналогично заданию условий расширенного поиска; *Параметры* -- имеет смысл только при указанных параметрах фильтра; с её помощью осуществляется сопоставление параметров фильтра и переменных бизнес-процесса. Для этого необходимо: с помощью кнопки *Настроить фильтр* определить параметры атрибутивного поиска фильтра, затем с помощью кнопки *Параметры* открыть окно *Параметры фильтра*. В колонке *Переменная процесса* следует выбрать объявленную переменную бизнес-процесса, значение которой будет присвоено параметру фильтра.

Функция *Мониторинг {dv}* со стандартными настройками не может найти более 100 карточек; это ограничение установлено с целью повышения производительности. Для увеличения количества возвращаемых по запросу карточек следует вручную отредактировать XML используемого поискового запроса, для чего нажать кнопку *Фильтр карточек*, перейти на вкладку *XML* и в строке `Search           Version="4300" Limit="100" CombineResults="OR"` исправить значение параметра [.keyword .parmname]_Limit_ на нужное.

image::Parameters_Monitoring_{dv}_Filter.png[Окно "Параметры фильтра"]

Мониторинг карточки::
  Переключатель позволяет осуществлять мониторинг изменения данных в отдельной карточке; параметры мониторинга определяются в следующих полях:
  +
  * *Карточка*: указывается карточка или переменная бизнес-процесса типа карточка DV, которая будет проверяться на предмет обнаружения внесенных изменений;
  * если в поле *Карточка* (см. выше) не указана карточка, то в поле *Тип карточки* из раскрывающегося списка выбирается тип карточки (например, Входящий документ или Карточка файла с версиями), мониторинг которой будет производиться (список составляют все типы карточек, определенные в системе, включая карточки справочников); если в поле *Карточка* указана карточка, тип карточки определяется автоматически;
  * в поле *Выходная строка* указывается переменная процесса типа строка секции карточки DV, в которую будет возвращен результат мониторинга.

Следующие три переключателя позволяют конкретизировать изменения, которые будут отслеживаться при помощи мониторинга:

Мониторинг секции карточки на появление новых строк::
  Переключатель позволяет осуществлять мониторинг секции выбранной карточки на появление новых строк: в поле *Секция карточки* указывается секция карточки, мониторинг которой будет производиться (например, секция внутреннего документа *Ссылки на карточки*);
Мониторинг изменения поля строки::
  Переключатель позволяет осуществлять мониторинг поля секции выбранной карточки в указанной строке:
  +
  * в поле *Строка* укажите переменную бизнес-процесса типа строка секции карточки DV, значение поля которой будет проверяться на изменение. Если строка не указана, а указана карточка (напрямую или через переменную) будет осуществляться мониторинг первой строки указанной секции карточки;
  * в поле *Поле секции* укажите поле карточки, мониторинг которой будет осуществляться (например, отследить изменение поля *Название* указанной карточки входящего документа);
Атрибутивный мониторинг секции карточки::
  Переключатель позволяет осуществлять атрибутивный мониторинг поля секции карточки, условия которого указываются в соответствии со схемой menu:Название поля[Логическая операция > Значение поля]:
  +
  * в поле *Поле секции* указывается поле секции карточки, мониторинг которого будет производиться;
  * в поле *Операция* указывается логическая операция, по которой осуществляется атрибутивный мониторинг поля секции карточки (равно, не равно, содержит, не содержит, больше чем, больше или равно, меньше чем, меньше или равно, строки равны, строки не равны, начинается с, кончается на, пустое значение, непустое значение);
  * в поле *Значение* указывается значение поля секции, с которым осуществляется сравнение по логической операции в процессе мониторинга.

Для корректной работы функции мониторинга при отслеживании изменений отдельной карточки должно быть включено журналирование операций с карточками. Для того, чтобы проверить, включён ли данный параметр, перейдите в справочник _Системные настройки_, затем последовательно menu:*Настройки журналов* > *Типы журналов* > *Система*.
