= Запуск и мониторинг выполнения бизнес-процесса

[#create-instance]
== Создание экземпляра бизнес-процесса

После того как шаблон бизнес-процесса был создан и сохранён, по нему можно создать экземпляр бизнес-процесса, выполняющий описываемое шаблоном действие. Экземпляр запускается в момент создания; одновременное количество активных экземпляров, сформированных по одному шаблону, не ограничено.

.Создание и запуск экземпляра бизнес-процесса по его шаблону можно осуществить двумя способами:
. При открытой карточке шаблона бизнес-процесса: нажатием на кнопку *Создать и запустить экземпляр процесса* на панели инструментов карточки.
. Из {wincl}а без открытия карточки шаблона бизнес-процесса: выбрать в представлении требуемый шаблон и дважды нажать на него левой кнопкой мыши.

.При запуске экземпляра система попросит указать:
* Папку для размещения карточки экземпляра.
* Название экземпляра, по умолчанию ему будет присвоено имя _Экземпляр процесса Имя-шаблона-бизнес-процесса_.
* Значения переменных, в свойствах которых установлен флаг `*Значение переменной должно быть задано при создании экземпляра бизнес-процесса*`, если таковые имеются.

После завершения указанных действий пользователь получит сообщение об успешном создании экземпляра бизнес-процесса.

.Дайджест экземпляра бизнес-процесса состоит из его названия и (в скобках) состояния в текущий момент времени:
[cols="40%,60%",options="header"]
|===
|Название состояния |Описание

|`Активен`
|Для исполняющихся экземпляров бизнес-процессов.

|`Приостановлен из-за ошибки`
|Для экземпляров бизнес-процессов, остановленных системой из-за возникновения ошибки в ходе его выполнения.

|`Приостановлен`
|Для экземпляров, выполнение которых временно приостановлено пользователями.

|`Остановлен`
|Для экземпляров бизнес-процессов, остановленных пользователями.

|`Завершен успешно`
|Для завершившихся без ошибок экземпляров бизнес-процессов.
|===

Панель инструментов экземпляра бизнес-процесса похожа на панель инструментов его шаблона, однако на ней отсутствует кнопка *Создать и запустить экземпляр процесса* и имеются кнопки для управления экземпляром *Запустить*, *Приостановить*, *Остановить*.

Кроме того, на панели инструментов экземпляра бизнес-процесса имеется кнопка image:buttons/bp-template.png[Карточка с зелёной схемой] *Открыть шаблон процесса*, по нажатию которой открывается карточка шаблона данного экземпляра.

После остановки процесса при помощи кнопок *Остановить* и *Приостановить* его можно вновь активизировать нажатием кнопки *Запустить*, однако если процесс был остановлен кнопкой *Приостановить*, его выполнение продолжится с того места, на котором он был остановлен, если же для остановки процесса была использована кнопка *Остановить*, после повторного запуска система повторит процесс с начала.

Карточки активных экземпляров бизнес-процессов недоступны для редактирования, тогда как в приостановленные, остановленные и завершенные можно вносить изменения. После устранения ошибок или занесения изменений приостановленные и остановленные экземпляры могут снова переводиться в активное состояние путем нажатия на панели инструментов кнопки *Запустить*.

В целях уведомления об остановке экземпляра бизнес-процесса из-за ошибки система помещает его ярлык в личную папку создавшего экземпляр пользователя или в личную папку ответственного за бизнес-процесс, указанного на вкладке *Дополнительно* свойств процесса.

.Для наглядного описания функций в карточке бизнес-процесса используется легенда, которая с помощью разных цветов ярлыков отражает состояния функций:
[cols="40%,60%",options="header"]
|===
|Легенда |Описание

|Белый
|Исполнение функции не началось.

|Желтый
|Функция исполняется в момент просмотра карточки бизнес-процесса.

|Темно-серый
|Функция успешно завершена.

|Светло-серый
|Функция успешно выполнена, но не завершена.

|Красный
|Функция остановлена по ошибке.

|Красная рамка вокруг пиктограммы функции
|При выполнении функции в предыдущем проходе произошла ошибка.

|Желтая рамка вокруг пиктограммы функции
|И ходе исполнения функции было получено предупреждение (например о том, что не было введено значение обязательной переменной).

|Фиолетовый
|Функция находится в состоянии `Завершена связанной функцией`.

|Светло-синий
|Функция находится в состоянии `Прервана`.

2+|Ярлык функции _Задание_ может быть дополнительно выделен следующими цветами:

|Зеленый
|Исполнитель взял в работу, отложил или делегировал задание.

|Сиреневый
|Исполнитель отказался от выполнения задания.

|Темно-оранжевый
|Задание просрочено.
|===

[#bp-monitor]
== Монитор бизнес-процессов

Монитор бизнес-процессов предназначен для отображения информации об имеющихся в системе {dv} экземплярах бизнес-процессов, а также для управления ими. Для этого в панель инструментов монитора бизнес-процессов включены перечисленные в таблице кнопки.

[cols="10%,20%,70%",options="header"]
|===
|Кнопка |Название |Описание действия

|image:buttons/properties.png[Свойства]
|*Свойства*
|Позволяет установить частоту автоматического обновления данных монитора бизнес-процессов.

|image:buttons/refresh.png[Круговые стрелки]
|*Обновить*
|Позволяет вручную обновить данные монитора.

|image:buttons/run.png[Зелёный треугольник]
|*Запустить*
|Запускает приостановленные и остановленные бизнес-процессов.

|image:buttons/stop.png[Красный квадрат]
|*Остановить*
|Останавливает работу активного бизнес-процесса.

|image:buttons/pause.png[Пауза]
|*Приостановить*
|Приостанавливает работу активного бизнес-процесса.

|image:buttons/delete.png[Красный крестик]
|*Удалить*
|Приводит к удалению записи об экземпляре бизнес-процесса из монитора бизнес-процессов, а также его карточки из папки, где она содержится.
|===

Монитор бизнес-процессов предоставляет возможность выборочного просмотра информации. Монитор отбирает только бизнес-процессы в интересующем пользователя состоянии. Для этого нужно поставить флаги напротив названий нужного состояния и нажать кнопку *Показать*.

.При использовании монитора бизнес-процессов следует учитывать следующие правила:
* По умолчанию данные монитора бизнес-процессов автоматически не обновляются, частота обновления равна `0`.
* Можно указать автоматическое обновление данных монитора бизнес-процессов в пределах от `5` до `60` секунд.
* Вне зависимости от состояния экземпляр бизнес-процесса можно сделать доступным для просмотра двойным щелчком левой кнопкой мыши по его записи, причем:
** Активный бизнес-процесс недоступен для редактирования, однако доступен для просмотра в целях установления стадии его работы, активных и выполненных функций, а также просмотра журнала бизнес-процесса.
** Изменение свойств экземпляра бизнес-процесса, а также свойств входящих в него функций и переменных возможно после нажатия кнопок *Остановить*, *Приостановить* или после остановки бизнес-процесса по ошибке.
* Нажатие кнопки *Приостановить* вызывает остановку бизнес-процесса на той функции, которая активна в момент нажатия; последующий запуск бизнес-процесса будет произведен с места приостановки.
* Нажатие кнопки *Остановить* вызывает полную остановку бизнес-процесса. Последующий его запуск будет производиться с начальной функции.
* Запуск, остановка, приостановка и удаление бизнес-процессов может производиться из контекстного меню, открывающегося при щелчке правой кнопкой мыши по записи бизнес-процесса.

[#bp-log]
== Просмотр журнала бизнес-процесса

Для отладки, обнаружения ошибок и мест сбоев может быть полезно просматривать выполнение экземпляра бизнес-процесса поэтапно. Поэтапное выполнение фиксируется в журнале бизнес-процесса. Журнал открывается нажатием кнопки *Журнал процесса* на панели инструментов в карточке активного или завершенного экземпляра бизнес-процесса.

Кроме того, можно просмотреть журнал активного бизнес-процесса, чтобы уточнить ход его выполнения. При этом получение последних данных о ходе бизнес-процесса можно получить нажатием кнопки *Обновить*.

.Информация о выполнении БП представлена в виде таблицы со следующими колонками:
[cols=","]
|===
|Тип
|Информация о выполнении или ошибка выполнения.

|Порядок
|Номер сообщения по порядку.

|Дата
|Дата и время происходящего события.

|Приоритет
|Приоритет выполнения БП.

|Сообщение
|Описание выполняемого действия.

|Имя функции
|Имя функции, выполняющей действие.

|Состояние
|Выполнено или завершается по ошибке.
|===

Если записи журнала не помещаются на экране, можно изменить высоту строк или ширину столбцов журнала. Для этого поместите курсор на левую или верхнюю границу таблицы. Когда курсор изменит форму, нажмите кнопкой мыши и перетаскиванием измените высоту строки до желаемого размера.

Еще более детальные сведения о выполнении бизнес-процесса можно получить нажатием кнопки *Подробнее* или двойным нажатием по одной из строк журнала.

.Поля открывающегося при этом окна "Данные сообщения" содержат следующие сведения о ходе бизнес-процесса:
[cols=","]
|===
|Дата
|Дата и время события.

|Тип
|Информация о выполнении или ошибка выполнения.

|Функция
|Название выполняемой функции.

|Приоритет
|Приоритет выполнения БП.

|Состояние функции
|Выполнено или завершается по ошибке.

|Сообщение
|Описание выполняемое действие.
|===

Для большей детализации данных журнала нажмите кнопку *Больше*, открывающую в окне дополнительные поля _Детали сообщения_, _Входящие данные_ и _Исходящие данные_.

При помощи кнопок *Предыдущее* и *Следующее* можно переключаться между сообщениями о ходе выполнения бизнес-процесса. Свернуть дополнительные поля окна можно при помощи кнопки *Меньше*.

Кнопка *Удалить* позволяет удалить сообщение из журнала.

Экспортировать содержимое журнала бизнес-процесса в файл формата `.xml` можно нажатием кнопки *Экспорт*.

[#var-log]
== Просмотр журнала изменений значения переменной

Помимо хода выполнения бизнес-процесса можно отследить последовательность изменения значений переменной при помощи специального журнала. Эта функция также может оказаться полезной для поиска ошибок и мест сбоев бизнес-процесса. Журнал ведется, если при определении параметров переменной был установлен флаг `*Сохранять историю значений при исполнении бизнес-процесса*`.

В журнале отображаются как завершенные, так и активные экземпляры бизнес-процессов.

Чтобы открыть журнал изменений значения переменной, откройте окно _Свойства процесса_ нажатием кнопки *Настройки* на панели инструментов. Перейдите на вкладку _Переменные_ и выделите переменную в списке. Нажмите кнопку *Изменить* или дважды нажмите на переменную, затем в открывшемся окне нажмите кнопку *Журнал*.

В окне _Журнал значений_ переменной перечислены дата и время изменения значения выбранной переменной, а также присваиваемые ей в эти моменты значения.

Кнопка *Обновить* позволяет уточнить сведения с учетом изменений, происшедших с момента открытия журнала.

[#stop-go]
== Приостановка, остановка и перезапуск бизнес-процессов

Описанный и отлаженный шаблон бизнес-процесса допускает создание и запуск неограниченного количества экземпляров, каждый из которых может быть предназначен для выполнения отдельной задачи в зависимости от указываемых при его создании параметров. После запуска экземпляр может быть остановлен, приостановлен и запущен заново.

.При этом выполняются следующие правила:
* Вне зависимости от состояния экземпляр бизнес-процесса можно сделать доступным для просмотра двойным нажатием левой кнопкой мыши по его записи.
+
.При этом:
** Активный бизнес-процесс недоступен для редактирования, но доступен для просмотра: установления стадии его работы, активных и выполненных функций, а также просмотра журнала бизнес-процесса.
** Изменить свойства экземпляра бизнес-процесса, а также свойства входящих в него функций и переменных возможно нажатием кнопок *Остановить*, *Приостановить* или после остановки бизнес-процесса по ошибке.
* Нажатие кнопки *Приостановить* останавливает бизнес-процесс на функции, активной в момент нажатия. Последующий запуск бизнес-процесса будет произведен с места приостановки.
* Нажатие кнопки *Остановить* вызывает полную остановку бизнес-процесса. Последующий его запуск будет производиться с начальной функции.
