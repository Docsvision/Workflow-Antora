= Запуск и мониторинг выполнения бизнес-процесса

[#create-instance]
== Создание экземпляра бизнес-процесса

После того как шаблон бизнес-процесса был создан и сохранён, по нему можно создать экземпляр бизнес-процесса, выполняющий описываемое шаблоном действие. Экземпляр запускается в момент создания; одновременное количество активных экземпляров, сформированных по одному шаблону, не ограничено.

.Создание и запуск экземпляра бизнес-процесса по его шаблону можно осуществить двумя способами:
. При открытой карточке шаблона бизнес-процесса: нажатием на кнопку *Создать и запустить экземпляр процесса* на панели инструментов карточки.
. Из {wincl}а без открытия карточки шаблона бизнес-процесса: выбрать в представлении требуемый шаблон и дважды нажать на него левой кнопкой мыши.

.При запуске экземпляра система попросит указать:
* Папку для размещения карточки экземпляра.
* Название экземпляра, по умолчанию ему будет присвоено имя _Экземпляр процесса Имя-шаблона-бизнес-процесса_.
* Значения переменных, в свойствах которых установлен флаг `*Значение переменной должно быть задано при создании экземпляра бизнес-процесса*`, если таковые имеются.

После завершения указанных действий пользователь получит сообщение об успешном создании экземпляра бизнес-процесса.

.Дайджест экземпляра бизнес-процесса состоит из его названия и (в скобках) состояния в текущий момент времени:
[cols="37%,63%",options="header"]
|===
|Название состояния |Описание
|*Активен* |Для исполняющихся экземпляров бизнес-процессов
|*Приостановлен из-за ошибки* |Для экземпляров бизнес-процессов, остановленных системой из-за возникновения ошибки в ходе его выполнения
|*Приостановлен* |Для экземпляров, выполнение которых временно приостановлено пользователями
|*Остановлен* |Для экземпляров бизнес-процессов, остановленных пользователями
|*Завершен успешно* |Для завершившихся без ошибок экземпляров бизнес-процессов
|===

Панель инструментов экземпляра бизнес-процесса похожа на панель инструментов его шаблона, однако на ней отсутствует кнопка *Создать и запустить экземпляр процесса* и имеются кнопки для управления экземпляром *Запустить*, *Приостановить*, *Остановить*.

Кроме того, на панели инструментов экземпляра бизнес-процесса имеется кнопка image:buttons/bp-template.png[image] *Открыть шаблон процесса*, по нажатию которой открывается карточка шаблона данного экземпляра.

После остановки процесса при помощи кнопок *Остановить* и *Приостановить* его можно вновь активизировать нажатием кнопки *Запустить*, однако если процесс был остановлен кнопкой *Приостановить*, его выполнение продолжится с того места, на котором он был остановлен, если же для остановки процесса была использована кнопка *Остановить*, после повторного запуска система повторит процесс с начала.

Карточки активных экземпляров бизнес-процессов недоступны для редактирования, тогда как в приостановленные, остановленные и завершенные можно вносить изменения. После устранения ошибок или занесения изменений приостановленные и остановленные экземпляры могут снова переводиться в активное состояние путем нажатия на панели инструментов кнопки *Запустить*.

В целях уведомления об остановке экземпляра бизнес-процесса из-за ошибки система помещает его ярлык в личную папку создавшего экземпляр пользователя или в личную папку ответственного за бизнес-процесс, указанного на вкладке *Дополнительно* свойств процесса.

Для наглядного описания функций в карточке бизнес-процесса используется легенда, которая с помощью разных цветов ярлыков отражает состояния функций.

[cols="37%,63%",options="header"]
|===
|Легенда |Описание
|*Белый* |Исполнение функции не началось
|*Желтый* |Функция исполняется в момент просмотра карточки бизнес-процесса
|*Темно-серый* |Функция успешно завершена
|*Светло-серый* |Функция успешно выполнена, но не завершена
|*Красный* |Функция остановлена по ошибке
|*Красная рамка вокруг пиктограммы функции* |При выполнении функции в предыдущем проходе произошла ошибка
|*Желтая рамка вокруг пиктограммы функции* |И ходе исполнения функции было получено предупреждение (например о том, что не было введено значение обязательной переменной)
|*Фиолетовый* |Функция находится в состоянии `Завершена связанной        функцией`
|*Светло-синий* |Функция находится в состоянии `Прервана`
|ярлык функции *Задание* может быть дополнительно выделен следующими цветами |
|*Зеленый* |Исполнитель взял в работу, отложил или делегировал задание
|*Сиреневый* |Исполнитель отказался от выполнения задания
|*Темно-оранжевый* |Задание просрочено
|===

[#bp-monitor]
== Монитор бизнес-процессов

Монитор бизнес-процессов предназначен для отображения информации об имеющихся в системе {dv} экземплярах бизнес-процессов, а также для управления ими. Для этого в панель инструментов монитора бизнес-процессов включены перечисленные в таблице кнопки.

[cols="13%,18%,69%",options="header"]
|===
|Кнопка |Название |Описание действия
|image:buttons/Properties.png[image] |*Свойства* |Позволяет установить частоту автоматического обновления данных монитора бизнес-процессов
|image:buttons/Update.png[image] |*Обновить* |Позволяет вручную обновить данные монитора
|image:buttons/Run.png[image] |*Запустить* |Запускает приостановленные и остановленные бизнес-процессов
|image:buttons/Stop.png[image] |*Остановить* |Останавливает работу активного бизнес-процесса
|image:buttons/Pause.png[image] |*Приостановить* |приостанавливает работу активного бизнес-процесса
|image:buttons/Delete.png[image] |*Удалить* |Приводит к удалению записи об экземпляре бизнес-процесса из монитора бизнес-процессов, а также его карточки из папки, где она содержится
|===

Монитор бизнес-процессов предоставляет возможность выборочного просмотра информации, отбирая только бизнес-процессы, находящиеся в интересующем пользователя состоянии. Для этого нужно поставить флажки возле названий нужного состояния и нажать кнопку *Показать*.

При использовании монитора бизнес-процессов следует учитывать следующие правила:

* по умолчанию автоматического обновления данных монитора бизнес-процессов не происходит, а частота обновления равна 0;
* можно указать автоматическое обновление данных монитора бизнес-процессов в пределах от 5 до 60 секунд;
* вне зависимости от состояния экземпляр бизнес-процесса можно сделать доступным для просмотра двойным щелчком левой кнопкой мыши по его записи, причем:
** активный бизнес-процесс недоступен для редактирования, однако доступен для просмотра в целях установления стадии его работы, активных и выполненных функций, а также просмотра журнала бизнес-процесса;
** изменение свойств экземпляра бизнес-процесса, а также свойств входящих в него функций и переменных возможно после нажатия кнопок *Остановить*, *Приостановить* или после остановки бизнес-процесса по ошибке;
* нажатие кнопки *Приостановить* вызывает остановку бизнес-процесса на той функции, которая активна в момент нажатия; последующий запуск бизнес-процесса будет произведен с места приостановки;
* нажатие кнопки *Остановить* вызывает полную остановку бизнес-процесса; последующий его запуск будет производиться с начальной функции;
* запуск, остановка, приостановка и удаление бизнес-процессов может производиться из контекстного меню, открывающегося при щелчке правой кнопкой мыши по записи бизнес-процесса.

[#bp-log]
== Просмотр журнала бизнес-процесса

Для отладки, обнаружения ошибок и мест сбоев может оказаться полезным поэтапный просмотр выполнения экземпляра бизнес-процесса, который фиксируется в журнале бизнес-процесса. Журнал открывается при нажатии кнопки *Журнал процесса* на панели инструментов карточки активного или завершенного экземпляра бизнес-процесса.

Кроме того, возможен просмотр журнала активного бизнес-процесса в целях уточнения хода его выполнения; при этом получение последних данных о ходе бизнес-процесса можно получить при помощи кнопки *Обновить*.

Информация о выполнении представлена в виде таблицы, содержащей следующие колонки:

Тип::
Информация о выполнении или ошибка выполнения.
Порядок::
Номер сообщения по порядку.
Дата::
Дата и время происходящего события.
Приоритет::
Сообщение::
Описание выполняемого действия.
Имя функции::
Имя функции, выполняющей действие.
Состояние::
Выполнено или завершается по ошибке.

В случае если записи журнала не помещаются на экране, можно изменить высоту строк или ширину столбцов журнала. Для этого следует поместить курсор на левую (для изменения ширины столбца -- верхнюю) границу таблицы и, когда он изменит форму (на горизонтальной линии курсор принимает форму стрелки вверх–вниз, на вертикальной -- стрелки вправо-влево), щелкнуть кнопкой мыши и, не отпуская ее, изменить высоту строки до желаемого размера.

Еще более детальные сведения о выполнении бизнес-процесса можно получить, нажав кнопку *Подробнее* или дважды щелкнув по одной из строк журнала. Поля открывающегося при этом окна *Данные сообщения* содержат следующие сведения о ходе бизнес-процесса:

Дата::
Дата и время события.
Тип::
Информация о выполнении или ошибка выполнения.
Функция::
Название выполняемой функции.
Приоритет::
Состояние функции::
Сообщение::
Описание выполняемое действие.

Для дальнейшей детализации данных журнала следует нажать кнопку *Больше*, открывающую в окне дополнительные поля *Детали сообщения*, *Входящие данные* и *Исходящие данные*.

Навигация по сообщениям о ходе выполнения бизнес-процесса осуществляется при помощи кнопок *Предыдущее* и *Следующее*. Уменьшить окно, свернув дополнительные поля, можно при помощи кнопки *Меньше*.

Кнопка *Удалить* позволяет удалить сообщение из журнала.

Экспортировать содержимое журнала бизнес-процесса в файл формата _.xml_ можно нажав кнопку *Экспорт*.

[#var-log]
== Просмотр журнала изменений значения переменной

Помимо просмотра хода выполнения бизнес-процесса, можно проследить последовательность изменения значений переменной при помощи специального журнала. Эта функция также может оказаться полезной для обнаружения ошибок и мест сбоев бизнес-процесса. Журнал ведется в том случае, если при определении параметров переменной был установлен флаг *Сохранять историю значений при исполнении бизнес-процесса*.

Просмотр журнала доступен как для завершенных, так и для активных экземпляров бизнес-процессов.

Для открытия журнала изменений значения переменной откройте окно *Свойства процесса* при помощи кнопки панели инструментов *Настройки*. Перейдите на вкладку *Переменные* и выделите переменную в списке. Нажмите кнопку *Изменить* или дважды щелкните по нужной переменной и в открывшемся окне нажмите кнопку *Журнал*.

В открывшемся окне *Журнал значений* переменной перечислены дата и время изменения значения выбранной переменной, а также присваиваемые ей в эти моменты значения.

Кнопка *Обновить* позволяет уточнить сведения с учетом изменений, происшедших с момента открытия журнала.

[#stop-go]
== Приостановка, остановка и перезапуск бизнес-процессов

Описанный и отлаженный шаблон бизнес-процесса допускает создание и запуск неограниченного количества экземпляров, каждый из которых может быть предназначен для выполнения отдельной задачи в зависимости от указываемых при его создании параметров. После запуска экземпляр может быть остановлен, приостановлен и запущен заново, при этом выполняются следующие правила:

* Вне зависимости от состояния экземпляр бизнес-процесса можно сделать доступным для просмотра двойным щелчком левой кнопкой мыши по его записи, причем:
** активный бизнес-процесс недоступен для редактирования, однако доступен для просмотра в целях установления стадии его работы, активных и выполненных функций, а также просмотра журнала бизнес-процесса;
** изменение свойств экземпляра бизнес-процесса, а также свойств входящих в него функций и переменных возможно после нажатия кнопок *Остановить*, *Приостановить* или после остановки бизнес-процесса по ошибке.
* Нажатие кнопки *Приостановить* вызывает остановку бизнес-процесса на той функции, которая активна в момент нажатия; последующий запуск бизнес-процесса будет произведен с места приостановки.
* Нажатие кнопки *Остановить* вызывает полную остановку бизнес-процесса; последующий его запуск будет производиться с начальной функции.
