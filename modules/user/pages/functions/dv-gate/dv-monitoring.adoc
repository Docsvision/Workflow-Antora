= Мониторинг {dv}

.Пиктограмма функции
image::buttons/Function_Monitoring_{dv}.png[Лист, скрепка, очки]

== Общее описание функции

.Функция "Мониторинг {dv}" позволяет обнаружить объект {dv}:
* Обладающий определенными свойствами: аналогично поиску объектов, соответствующих критериям фильтрации.
* Отслеживать вносимые в карточку изменения: добавление и удаление строк, изменение значения поля
* Находить версии карточек файлов.

В настройках функции мониторинга указывается переменная процесса, в которую будет возвращена ссылка на найденный объект или объекты. Чтобы получить несколько объектов, укажите переменную-коллекцию.

== Настройка параметров

.Свойства функции "Мониторинг {dv}". Вкладка "Параметры"
image::dv-monitoring-params.png[Свойства функции "Мониторинг {dv}". Вкладка "Параметры"]

На вкладке _Параметры_ окна свойств функции указываются параметры мониторинга карточек {dv}.

Очищать историю мониторинга::
В поле выбирается значение (или переменная бизнес-процесса) типа *_Да/Нет_*. +
Указанное значение определяет, будет ли удаляться (*_Да_*) или сохраняться (*_Нет_*) история мониторинга при повторном выполнении функции.
+
При удалении истории каждый повторный запуск функции мониторинга обеспечивает поиск всех удовлетворяющих условию объектов {dv} без учета результатов предыдущего мониторинга. Например, после добавления нового документа повторный мониторинг {dv} приведет к обработке всех документов папки, если в данном поле указано *_Да_*, и к обработке только вновь появившегося документа, если в данном поле указано *_Нет_*.

При неудаче активировать связь::
В поле может быть занесено название функции, которой будет передано управление процессом в случае если объект с нужными свойствами не будет найден при однократном мониторинге.
+
Для корректной работы мониторинга необходимо, чтобы между функцией мониторинга и функцией, указанной в поле _При неудаче активировать связь_, была установлена связь типа _При успехе_, иначе при неудаче мониторинга процесс будет остановлен из-за ошибки. +
Связь типа _При ошибке_ между функцией мониторинга и указанной в поле _При неудаче активировать связь_ функцией устанавливают, если управление должно перейти к ней в случае невозможности мониторинга, например, недоступности его объекта. Иначе в этом случае процесс будет остановлен из-за ошибки. При необходимости связи типа _При ошибке_ и _При успехе_ можно установить одновременно.
+
.Далее следуют два переключателя, позволяющие выбрать, над чем будет производиться мониторинг:
--
* Над объектами *Мониторинг карточек {dv}*.
* Над событиями, происходящими с каким-либо объектом *Мониторинг карточки*.
--
+
Выбрать можно только один из переключателей. После выбора переключателя становится доступной для описания соответствующая группа параметров

Мониторинг карточек {dv}::
Переключатель позволяет обнаруживать уже имеющиеся и вновь появляющиеся карточки {dv}, соответствующие указанным критериям.
+
--
.Параметры мониторинга указываются в следующих полях:
* В поле _Параметр процесса -- карточка_ указывается переменная бизнес-процесса типа карточка DV, в которую будет возвращена ссылка на найденную карточку (карточки).
* В раскрывающихся списках в поле _Сортировать результаты_ выбираются параметры сортировки. Параметры сортировки позволяют упорядочить результаты мониторинга.
** В первом списке выбирается тип сортировки: *_Не сортировать_*, *_По дате создания_*, *_По дате изменения_*, *_По дайджесту_*.
** Во втором списке выбирается способ сортировки: *_По возрастанию_* или *_По убыванию_*.
* В раскрывающемся списке поля _Папка поиска_ с использованием флага `*Искать в подпапках*` следует указать область поиска. Если область поиска не задана, поиск осуществляется по всем папкам системы.
* _Фильтр карточек_ позволяет установить параметры поиска карточек с помощью кнопки *Настроить фильтр*. Параметры задаются по аналогии с настройкой условий расширенного поиска. +
Кнопка *Параметры* имеет смысл только при указанных параметрах фильтра. С её помощью осуществляется сопоставление параметров фильтра и переменных бизнес-процесса. Для этого необходимо: с помощью кнопки *Настроить фильтр* определить параметры атрибутивного поиска фильтра, затем с помощью кнопки *Параметры* открыть окно _Параметры фильтра_. В колонке _Переменная процесса_ следует выбрать объявленную переменную бизнес-процесса, значение которой будет присвоено параметру фильтра.
--
+
Функция _Мониторинг {dv}_ со стандартными настройками не может найти более 100 карточек. Это ограничение установлено с целью повышения производительности. Чтобы увеличить количество возвращаемых по запросу карточек, вручную отредактируйте XML используемого поискового запроса после нажатия на кнопку *Фильтр карточек*. На вкладке _XML_ и в строке `Search Version="4300" Limit="100" CombineResults="OR"` исправьте значение параметра _Limit_ на нужное.
+
.Окно "Параметры фильтра"
image::filter-params.png[Окно "Параметры фильтра"]

Мониторинг карточки::
Переключатель позволяет осуществлять мониторинг изменения данных в отдельной карточке; параметры мониторинга определяются в следующих полях:
+
**Карточка*: указывается карточка или переменная бизнес-процесса типа карточка DV, которая будет проверяться на предмет обнаружения внесенных изменений;
*если в поле *Карточка* (см. выше) не указана карточка, то в поле *Тип карточки* из раскрывающегося списка выбирается тип карточки (например, Входящий документ или Карточка файла с версиями), мониторинг которой будет производиться (список составляют все типы карточек, определенные в системе, включая карточки справочников); если в поле *Карточка* указана карточка, тип карточки определяется автоматически;
*в поле *Выходная строка* указывается переменная процесса типа строка секции карточки DV, в которую будет возвращен результат мониторинга.

Следующие три переключателя позволяют конкретизировать изменения, которые будут отслеживаться при помощи мониторинга:

Мониторинг секции карточки на появление новых строк::
Переключатель позволяет осуществлять мониторинг секции выбранной карточки на появление новых строк: в поле *Секция карточки* указывается секция карточки, мониторинг которой будет производиться (например, секция внутреннего документа *Ссылки на карточки*);
Мониторинг изменения поля строки::
Переключатель позволяет осуществлять мониторинг поля секции выбранной карточки в указанной строке:
+
*в поле *Строка* укажите переменную бизнес-процесса типа строка секции карточки DV, значение поля которой будет проверяться на изменение. Если строка не указана, а указана карточка (напрямую или через переменную) будет осуществляться мониторинг первой строки указанной секции карточки;
*в поле *Поле секции* укажите поле карточки, мониторинг которой будет осуществляться (например, отследить изменение поля *Название* указанной карточки входящего документа);
Атрибутивный мониторинг секции карточки::
Переключатель позволяет осуществлять атрибутивный мониторинг поля секции карточки, условия которого указываются в соответствии со схемой menu:Название поля[Логическая операция > Значение поля]:
+
*в поле *Поле секции* указывается поле секции карточки, мониторинг которого будет производиться;
*в поле *Операция* указывается логическая операция, по которой осуществляется атрибутивный мониторинг поля секции карточки (равно, не равно, содержит, не содержит, больше чем, больше или равно, меньше чем, меньше или равно, строки равны, строки не равны, начинается с, кончается на, пустое значение, непустое значение);
*в поле *Значение* указывается значение поля секции, с которым осуществляется сравнение по логической операции в процессе мониторинга.

Для корректной работы функции мониторинга при отслеживании изменений отдельной карточки должно быть включено журналирование операций с карточками. Для того, чтобы проверить, включён ли данный параметр, перейдите в справочник _Системные настройки_, затем последовательно menu:*Настройки журналов* > *Типы журналов* > *Система*.
