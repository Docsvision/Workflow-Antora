= Конструктор бизнес-процессов

_Конструктор бизнес-процессов_ является компонентом модуля _{wf}_, который обеспечивает возможность настройки БП, а именно: создание диаграммы БП из функций и связей между ними, настройка свойств функций БП, настройка общих параметров БП.

.Окно "Конструктора бизнес-процессов" состоит из трех основных элементов:
. Панель инструментов.
. Функциональная панель с пиктограммами стандартных функций модуля _{wf}_ и функций, которые предоставляют _шлюзы_.
. Область графа, в которой настраивается схема (работы) бизнес-процесса: функции БП и связи между ними.

.Обычный режим работы "Конструктора бизнес-процессов"
image::bp-designer-regular.png[Обычный режим работы "Конструктора бизнес-процессов"]

.Для _Конструктора бизнес-процессов_ предусмотрено два режима работы:
* Обычный -- представлен на рисунке выше.
* Упрощенный -- представлен на рисунке ниже. В упрощённом режиме работы часть функций и элементов панели инструментов будут скрыты.

.Упрощенный режим работы "Конструктора бизнес-процессов"
image::bp-designer-simple.png[Упрощенный режим работы "Конструктора бизнес-процессов"]

Сменить режим можно с помощью кнопки image:buttons/card-arrow-down.png[image] на панели инструментов.

[#toolbar]
== Панель инструментов Конструктора бизнес-процессов

В следующей таблице приведены команды и описание команд панель инструментов "Конструктора бизнес-процессов".

.Панель инструментов "Конструктора бизнес-процессов"
[cols="10%,30%,60%",options="header"]
|===
|Кнопка |Название |Описание действия
|image:buttons/save.png[Дискета]
|Сохранить
|Сохраняет изменения в шаблоне бизнес-процесса

|image:buttons/settings.png[Настройки]
|Настройки
|Открывает диалогового окно с параметрами шаблона бизнес-процесса (название, описание, статус, используемые переменные и шлюзы и пр.)

|image:buttons/triangle-right.png[Треугольник вершиной вправо]
|Создать и запустить экземпляр процесса
|Создает и запускает экземпляр процесса

|image:buttons/zoom-in.png[Лупа с плюсом]
|Увеличить
|Увеличивает масштаба изображения

|image:buttons/zoom-out.png[Лупа с минусом]
|Уменьшить
|Уменьшает масштаба изображения

|image:buttons/export-image.png[Стрелка JPG]
|Экспорт в картинку
|Экспортирует изображения области графа в файл формата WMF (с расширением ".bmp")

|image:buttons/transition-labels.png[Лист с кругами]
|Показывать метки переходов
|При нажатии кнопки на экране отображаются названия связей между функциями, если названия установлены

|image:buttons/export-xml.png[Стрелка XML]
|Экспорт в XML
|Экспортирует настройки БП в файл XML

|image:buttons/import-xml.png[Стрелка XML]
|Импорт из XML
|Импортирует настройки БП из файла XML, текущие настройки будут заменены

|image:buttons/parent-card.png[Карточка]
|Открыть родительскую карточку
|Открывает карточку, из которой был создан экземпляр данного БП

|image:buttons/parent-bp.png[Карточка с красной схемой]
|Открыть родительский процесс
|Открывает карточку родительского БП из подпроцесса (функции "Подпроцесс")

|image:buttons/bp-template.png[Карточка с зелёной схемой]
|Открыть шаблон процесса
|Открывает карточку шаблона бизнес-процесса, на основе которого создан данный экземпляр БП

|image:buttons/bp-log.png[Карточка журнала]
|Журнал процесса
|Открывает журнал работы БП

|image:buttons/print.png[Принтер]
|Печать
|Печатает данные БП с использованием выбранного шаблона печати, или пересылает данные по электронной почте
|===

[#function-properties]
== Свойства функций

Для каждой из указанных в бизнес-процессе функций определяется особый, присущий только ей набор свойств и параметров. Полное описание каждой функции производится в отдельном диалоговом окне, открывающемся при выборе пункта _Свойства_ из контекстного меню функции.

.Набор параметров, переменных и свойств для каждого типа функций различен, но имеются сходства:
* Окна свойств всех функций содержат вкладку _Общие_, отличающиеся только пиктограммой функции.
* Окна свойств всех функций содержат вкладку _Настройки вехи_. Настройки этой вкладки позволяют указать и контролировать допустимые сроки выполнения функции.
* Окно свойств каждой функции в экземпляре бизнес-процесса содержит на одну вкладку больше, чем окно свойств шаблона бизнес-процесса. Эта вкладка называется _Экземпляры_ и представляет собой описание участия функции в бизнес-процессе.

Некоторые функции (начальная, конечная, объединения `И` и `ИЛИ`, а также разветвление) содержат только вкладки _Общие_ и _Настройки вехи_, которых достаточно для их описания.

[NOTE]
====
В последующих разделах вкладки _Основная_, _Настройки вехи_ и _Экземпляры_ настроек функций описываться не будут, поскольку являются идентичными для всех функций СУБП.
====

[#general]
=== Общие свойства

Внешний вид вкладки _Общие_ представлен на рисунке.

.Окно "Свойства: Начальная функция". Вкладка "Общие"
image::initial-function-properties.png[Окно "Свойства: Начальная функция". Вкладка "Общие"]

Вкладка _Общие_ отвечает за настройку поведения функции в процессе, одинакова для всех функций и включает пять полей, ни одно из которых не является обязательным для заполнения:

* _Название_ функции, по умолчанию совпадающее с названием базовой функции. Указанное в данном поле название в дальнейшем отображается в пиктограмме, обозначающей эту функцию в карточке бизнес-процесса.
* _Описание_ функции отображается во всплывающей подсказке при наведении курсора мыши на пиктограмму функции в карточке бизнес-процесса.
* _Период опроса (мин)_ задает в минутах продолжительность задержки перед повторной обработкой сервисом управления процессами активной функции. Начало повторного выполнения функции рассчитывается путем прибавления периода опроса к моменту предыдущего исполнения функции.
* _Переменная для описания ошибки_ -- переменная типа _Строка_, в которую будет записан текст ошибки, возникшей при выполнении функции.
* _Переменная для кода ошибки_ -- переменная типа _Целое_, в которую будет записано конвертированное в десятеричную систему счисления значение полученного кода ошибки, возникшей при выполнении функции.

[#milestone]
=== Настройки вехи

Веха -- функция, для которой задано время, до которого она должна быть исполнена. В дальнейшем вехи позволят находить при помощи расширенного поиска бизнес-процессы с превышенными сроками исполнения отдельных частей. Любая функция бизнес-процесса может быть назначена вехой на вкладке _Настройки вехи_.

Чтобы назначить функцию вехой, следует установить флаг `*Функция является вехой*`, после чего активизируются поля вкладки, предназначенные для указания контрольного времени.

.Контрольное время можно задать двумя способами:
* Явно, установив переключатель в положение *По абсолютной дате* и выбрав в соответствующем поле переменную процесса типа *_Дата/Время_*.
* По относительному моменту, установив переключатель в положение *Относительно времени запуска процесса/последнего завершения функции* и выбрав целочисленную переменную процесса, значение которой будет использовано при расчете времени вехи. Значение выбранной переменной задает число *часов* или *минут*, которое добавляется к времени запуска процесса/последней обработки функции при расчете времени вехи.
+
При выборе этой опции время вехи будет рассчитываться не один раз, а циклически, с периодом, равным значению указанной переменной. Первый расчет времени вехи осуществляется при запуске процесса, последующие -- при каждом успешном выполнении функции.

Значение выбранной для расчета времени вехи целочисленной переменной должно быть больше нуля.

.Окно "Свойства: конечная функция". Вкладка "Настройки вехи"
image::final-function-milestone.png[Окно "Свойства: конечная функция". Вкладка "Настройки вехи"]

Поле _Рассчитанное время вехи_ присутствует только в экземпляре процесса и доступно только для чтения. В поле в явном виде отображается _текущее рассчитанное время_ вехи. Если веха была задана *По абсолютной дате*, то после успешного завершения функции поле сменится строкой _Абсолютная веха достигнута_.

Бизнес-процессы с просроченным контрольным временем исполнения функции (временем вехи) могут быть найдены поисковым запросом. Пример такого запроса приведен на рисунке:

.Пример поискового запроса
image::search-query-sample.png[Пример поискового запроса]

[#instances]
=== Вкладка "Экземпляры" окна свойств функции

Пример отображения вкладки _Экземпляры_ приведен на рисунке.

.Окно "Свойства: конечная функция". Вкладка "Экземпляры"
image::final-function-properties.png[Окно "Свойства: конечная функция". Вкладка "Экземпляры"]

.Вкладка "Экземпляры" представляет собой описание участия функции в бизнес-процессе. Вкладка включает следующие элементы:
* _Текущее состояние_ функции в процессе. Текущее состояние функции может быть принудительно изменено с помощью раскрывающегося списка этого поля. Принудительное изменение текущего состояния используется при отладке бизнес-процесса.
* В секции _Время обработки_ ведется статистика времени обработки данной функции в этом процессе.
+
NOTE: Не следует путать время обработки и время выполнения функции, так как она может быть обработана, но не выполнена (например задание, которое ожидает чего-нибудь).
+
** _Последнее_ -- время последней обработки.
** _Среднее_ -- среднее арифметическое времени всех предыдущих обработок функции. Высчитывается исходя из предыдущего среднего, числа обработок функции и времени последней обработки функции.
** _Максимальное_ -- максимальное время обработки функции в проходе.
** _Минимальное_ -- минимальное время обработки функции в проходе (проход -- "экземпляр" выполняемой функции, копия настроек функции, над которой производятся операции).
** _Всего обработано_ -- количество раз, которое функция начинала и завершала свою обработку.

Все перечисленные значения указываются в миллисекундах.
