= Создание пользовательской функции на базе сценария

модуль _{wf}_ предоставляет универсальный метод для добавления требуемой функциональности в БП -- функция xref:Function_Script.adoc["Сценарий"], которая может содержать произвольный исходный код на языке C# и Visual Basic .NET.

Для создания сценария нужно:

. Добавить функцию "Сценарий" в шаблон БП.
. Открыть свойства добавленной функции.
. Нажать кнопку *Текст сценарий*. Будет открыто окно редактирования исходного кода скрипта.
+
image::Parameters_Script_TextScript.png[ Окно редактирования скрипта функции "Сценарий"]
. Написать исходный код скрипта (в функции Execute).
+
Инструкция по разработке скриптов приведена в документе _"{dv} 5". Руководство программиста_.
. Нажать на кнопку *Компилировать* для выполнения проверки исходного кода скрипта на наличие ошибок.
+
По результатам компиляции будет выедено сообщение "Компиляция прошла успешно" или окно со списком ошибок.
. Нажать на кнопку *ОК* для сохранения исходного кода скрипта.
. Сохранить настройки функции "Сценарий" и завершить редактирование шаблона БП.

Редактор кода не поддерживает работу со сборками, подключенными с участием псевдонима ("extern alias mOM;"). При компиляции такого скрипта возникнет ошибка вида:

image::Parameters_Script_Error.png[ Окно ошибки]

Чтобы исключить данную ошибку:

* удалите конструкцию "extern alias mOM;", перепишите части кода, в которых используется пространство имен mOM, и установить флаг *Не добавлять ссылку на {dv}.Objectmanager.Interop.dll* в настройках функции;
* используйте простой редактор сценариев (установить флаг *Использовать простой редактор сценариев* в настройках функции);
* или не используйте функцию компиляции скрипта -- сам сценарий будет корректно скомпилирован (если нет ошибок) при работе сервиса Workflow.

Может возникнуть ситуация, когда при открытии сценария на редактирование происходит фатальная ошибка приложения и программа "{wincl}" закрывается. Такое поведение может быть связано с недоступностью одной из сборок, входящих {dv} или из дополнительных сборок, добавленных в сценарий в основном окне настройки функции *Сценарий*. В этом случае следует установить проблемную сборку либо в GAC, либо в каталог модуля "{wincl}".

С помощью функции "Сценарий" можно создать пользовательскую функцию (.Net-сборку), которую затем можно будет вставить в бизнес-процесс из *Универсальной функции*.

Для создания пользовательской функции следует открыть окно *Текст сценария*, ввести текст сценария и нажать кнопку *Создать сборку*. При этом откроется окно для выбора файла формата *.dll, в который будет сохранен сценарий.

Чтобы обеспечить возможность повторного использования сценария в виде скомпилированной сборки, в нем обязательно должен быть хоть один публичный (publiс) класс, а в нем должны присутствовать публичные статические методы.

Скомпилированные и подключенные сборки должны находится в папке серверной части модуля _{wf}_ (по умолчанию `C:\Program Files (x86)\{dv}\Workflow\5.5\`).

Просмотреть из функции "Сценарий" текст сценария, сохраненного как .Net-сборка, нельзя.
