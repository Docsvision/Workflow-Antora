=  Создание пользовательской функции на базе сценария

Модуль «Управление процессами» предоставляет универсальный метод для добавления требуемой функциональности в БП – функция xref:Function_Script.adoc[«Сценарий»], которая может содержать произвольный исходный код на языке C# и Visual Basic .NET.

Для создания сценария нужно:

. [.ph .cmd]#Добавить функцию «Сценарий» в шаблон БП.#
. [.ph .cmd]#Открыть свойства добавленной функции.#
. [.ph .cmd]#Нажать кнопку [.ph .uicontrol]*Текст сценарий*. Будет открыто окно редактирования исходного кода скрипта.#
+
image::Parameters_Script_TextScript.png[[.fig--title-label]#Рис. 1. # Окно редактирования скрипта функции «Сценарий»]
. [.ph .cmd]#Написать исходный код скрипта (в функции Execute).#
+
Инструкция по разработке скриптов приведена в документе [.dfn .term]_«Docsvision 5». Руководство программиста_.
. [.ph .cmd]#Нажать на кнопку [.ph .uicontrol]*Компилировать* для выполнения проверки исходного кода скрипта на наличие ошибок.#
+
По результатам компиляции будет выедено сообщение «Компиляция прошла успешно» или окно со списком ошибок.
. [.ph .cmd]#Нажать на кнопку [.ph .uicontrol]*ОК* для сохранения исходного кода скрипта.#
. [.ph .cmd]#Сохранить настройки функции «Сценарий» и завершить редактирование шаблона БП.#

Редактор кода не поддерживает работу со сборками, подключенными с участием псевдонима («extern alias mOM;»). При компиляции такого скрипта возникнет ошибка вида:

image::Parameters_Script_Error.png[[.fig--title-label]#Рис. 2. # Окно ошибки]

Чтобы исключить данную ошибку:

* удалите конструкцию «extern alias mOM;», перепишите части кода, в которых используется пространство имен mOM, и установить флаг [.ph .uicontrol]*Не добавлять ссылку на DocsVision.Objectmanager.Interop.dll* в настройках функции;
* используйте простой редактор сценариев (установить флаг [.ph .uicontrol]*Использовать простой редактор сценариев* в настройках функции);
* или не используйте функцию компиляции скрипта – сам сценарий будет корректно скомпилирован (если нет ошибок) при работе сервиса Workflow.

Может возникнуть ситуация, когда при открытии сценария на редактирование происходит фатальная ошибка приложения и программа «Windows-клиент» закрывается. Такое поведение может быть связано с недоступностью одной из сборок, входящих Docsvision или из дополнительных сборок, добавленных в сценарий в основном окне настройки функции [.keyword]*Сценарий*. В этом случае следует установить проблемную сборку либо в GAC, либо в каталог модуля «Windows-клиент».

С помощью функции «Сценарий» можно создать пользовательскую функцию (.Net-сборку), которую затем можно будет вставить в бизнес-процесс из [.keyword]*Универсальной функции*.

Для создания пользовательской функции следует открыть окно [.keyword .wintitle]*Текст сценария*, ввести текст сценария и нажать кнопку [.ph .uicontrol]*Создать сборку*. При этом откроется окно для выбора файла формата *.dll, в который будет сохранен сценарий.

Чтобы обеспечить возможность повторного использования сценария в виде скомпилированной сборки, в нем обязательно должен быть хоть один публичный (publiс) класс, а в нем должны присутствовать публичные статические методы.

Скомпилированные и подключенные сборки должны находится в папке серверной части модуля «Управление процессами» (по умолчанию [.ph .filepath]`C:\Program Files (x86)\Docsvision\Workflow\5.5\`).

Просмотреть из функции «Сценарий» текст сценария, сохраненного как .Net-сборка, нельзя.

* *xref:ScenaryProtection_businessprocess.adoc[Защита сценария бизнес-процесса]* +

*На уровень выше:* xref:Engineer_functions.adoc[Настройка бизнес-процессов]
